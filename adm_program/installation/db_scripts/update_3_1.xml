<?xml version="1.0" encoding="UTF-8"?>
<update>
    <step id="10">UPDATE %PREFIX%_preferences SET prf_value = '3' WHERE prf_name = 'max_file_upload_size'</step>
    <step id="20">UPDATE %PREFIX%_preferences SET prf_value = '1' WHERE prf_name = 'max_email_attachment_size'</step>
    <step id="30" database="mysql">ALTER TABLE %PREFIX%_users MODIFY COLUMN usr_password varchar(60)</step>
    <step id="40" database="mysql">ALTER TABLE %PREFIX%_users MODIFY COLUMN usr_new_password varchar(60)</step>
    <step id="50" database="postgresql">ALTER TABLE %PREFIX%_users ALTER COLUMN usr_password TYPE varchar(60)</step>
    <step id="60" database="postgresql">ALTER TABLE %PREFIX%_users ALTER COLUMN usr_new_password TYPE varchar(60)</step>
    <step id="70">UPDATE %PREFIX%_user_fields SET usf_type = 'PHONE' WHERE usf_name_intern IN ('PHONE', 'MOBILE', 'FAX')</step>
    <step id="80">ComponentUpdate::updateStepSetDefaultConfiguration</step>
    <step id="90">ALTER TABLE %PREFIX%_lists DROP COLUMN lst_default</step>
    <step id="100">ALTER TABLE %PREFIX%_announcements ADD COLUMN ann_org_id integer unsigned not null</step>
    <step id="110">UPDATE %PREFIX%_announcements SET ann_org_id = (SELECT org_id FROM %PREFIX%_organizations WHERE org_shortname = ann_org_shortname) WHERE ann_org_shortname IS NOT NULL</step>
    <step id="120" database="mysql">ALTER TABLE %PREFIX%_announcements DROP FOREIGN KEY %PREFIX%_FK_ANN_ORG</step>
    <step id="130" database="mysql">ALTER TABLE %PREFIX%_announcements DROP INDEX %PREFIX%_FK_ANN_ORG</step>
    <step id="140" database="postgresql">ALTER TABLE %PREFIX%_announcements DROP CONSTRAINT %PREFIX%_FK_ANN_ORG</step>
    <step id="150" database="postgresql">DROP INDEX %PREFIX%_FK_ANN_ORG</step>
    <step id="160">ALTER TABLE %PREFIX%_announcements DROP COLUMN ann_org_shortname</step>
    <step id="170">ALTER TABLE %PREFIX%_announcements ADD CONSTRAINT %PREFIX%_FK_ANN_ORG FOREIGN KEY (ann_org_id) REFERENCES %PREFIX%_organizations (org_id) on delete restrict on update restrict</step>
    <step id="180">ALTER TABLE %PREFIX%_photos ADD COLUMN pho_org_id integer unsigned not null</step>
    <step id="190">UPDATE %PREFIX%_photos SET pho_org_id = (SELECT org_id FROM %PREFIX%_organizations WHERE org_shortname = pho_org_shortname) WHERE pho_org_shortname IS NOT NULL</step>
    <step id="200" database="mysql">ALTER TABLE %PREFIX%_photos DROP FOREIGN KEY %PREFIX%_FK_PHO_ORG</step>
    <step id="210" database="mysql">ALTER TABLE %PREFIX%_photos DROP INDEX %PREFIX%_FK_PHO_ORG</step>
    <step id="220" database="postgresql">ALTER TABLE %PREFIX%_photos DROP CONSTRAINT %PREFIX%_FK_PHO_ORG</step>
    <step id="230" database="postgresql">DROP INDEX %PREFIX%_FK_PHO_ORG</step>
    <step id="240">ALTER TABLE %PREFIX%_photos DROP COLUMN pho_org_shortname</step>
    <step id="250">ALTER TABLE %PREFIX%_photos ADD CONSTRAINT %PREFIX%_FK_PHO_ORG FOREIGN KEY (pho_org_id) REFERENCES %PREFIX%_organizations (org_id) on delete restrict on update restrict</step>
    <step>stop</step>
</update>
